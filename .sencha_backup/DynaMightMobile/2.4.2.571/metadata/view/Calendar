{
    "type": "Ext.Panel",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Calendar",
        "itemId": "Calendar",
        "layout": "fit",
        "requires": [
            "Ext.ux.TouchCalendarView",
            "Ext.ux.TouchCalendarDayEvents",
            "Ext.ux.TouchCalendarEvents",
            "Ext.ux.TouchCalendarEventsBase",
            "Ext.ux.TouchCalendarMonthEvents",
            "Ext.ux.TouchCalendarWeekEvents"
        ]
    },
    "designerId": "f5128cdf-1ed9-4ea4-b817-1f22f10cc64c",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "initialize",
                "implHandler": [
                    "\r",
                    "this.callParent();\r",
                    "\r",
                    "var me = this, calendar,\r",
                    "    calendarStore = CreateStore(\"race\"),\r",
                    "    eventStore;\r",
                    "\r",
                    "//debugger;\r",
                    "\r",
                    "//calendarStore.setData([{name: 'a',id: '1'}]);\r",
                    "//calendarStore.load();\r",
                    "//calendarStore.sync();\r",
                    "\r",
                    "Ext.define(\"Event\", {\r",
                    "\textend: \"Ext.data.Model\",\r",
                    "\tconfig: {\r",
                    "\t\tfields: [{\r",
                    "\t\t\tname: 'event',\r",
                    "\t\t\ttype: 'string'\r",
                    "\t\t}, {\r",
                    "\t\t\tname: 'title',\r",
                    "\t\t\ttype: 'string'\r",
                    "\t\t}, {\r",
                    "\t\t\tname: 'fulltitle',\r",
                    "\t\t\ttype: 'string'\r",
                    "\t\t},{\r",
                    "\t\t\tname: 'start',\r",
                    "\t\t\ttype: 'date',\r",
                    "\t\t\tdateFormat: 'c'\r",
                    "\t\t}, {\r",
                    "\t\t\tname: 'end',\r",
                    "\t\t\ttype: 'date',\r",
                    "\t\t\tdateFormat: 'c'\r",
                    "\t\t}, {\r",
                    "\t\t\tname: 'color',\r",
                    "\t\t\ttype: 'string'\r",
                    "\t\t},{\r",
                    "\t\t\tname: 'css',\r",
                    "\t\t\ttype: 'string'\r",
                    "\t\t}]\r",
                    "\t}\r",
                    "});\r",
                    "\r",
                    "calendarStore.execConfig({\r",
                    "    params: {\r",
                    "        entityViewID: GetEntityViewByName('Club Calendar').entityviewid ,\r",
                    "        filters: ''\r",
                    "    },\r",
                    "    callback: function(records){\r",
                    "\r",
                    "        eventStore = Ext.create('Ext.data.Store', {\r",
                    "            model: 'Event',\r",
                    "            data:  me.processData(records)\r",
                    "        });\r",
                    "//debugger;\r",
                    "        calendar = Ext.create('Ext.ux.TouchCalendarView', {\r",
                    "                minDate: Ext.Date.add(new Date(), Ext.Date.DAY, -46),\r",
                    "                maxDate: Ext.Date.add(new Date(), Ext.Date.DAY, 60),\r",
                    "                viewMode: 'month',\r",
                    "                weekStart: 0,\r",
                    "                value: new Date(),\r",
                    "                eventStore: eventStore,\r",
                    "\r",
                    "                plugins: [Ext.create('Ext.ux.TouchCalendarEvents', {\r",
                    "                    eventBarTpl: '<div>{title}</div>',\r",
                    "                    colourField: 'color'//,\r",
                    "                })],\r",
                    "                listeners: {\r",
                    "                    eventtap: function(event){\r",
                    "                        Ext.Msg.alert(event.get('event'), event.get('fulltitle'));\r",
                    "\r",
                    "                    }\r",
                    "                }\r",
                    "            });\r",
                    "\r",
                    "        me.add({\r",
                    "            xtype: 'toolbar',\r",
                    "            docked: 'top',\r",
                    "            items: [{\r",
                    "                xtype: 'button',\r",
                    "                text: 'Month View',\r",
                    "                handler: function(){\r",
                    "                    calendar.setViewMode('month');\r",
                    "                }\r",
                    "            }, {\r",
                    "                xtype: 'button',\r",
                    "                text: 'Week View',\r",
                    "                handler: function(){\r",
                    "                    calendar.setViewMode('week');\r",
                    "                }\r",
                    "\r",
                    "            }]\r",
                    "        } );\r",
                    "\r",
                    "        me.add(\r",
                    "            calendar\r",
                    "        );\r",
                    "    }\r",
                    "});\r",
                    "\r",
                    "Ext.Viewport.setMasked(false);\r",
                    "\r",
                    ""
                ]
            },
            "name": "initialize",
            "designerId": "cd7e1b09-43e8-4f00-8dff-7d4fd2399775"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "records"
                ],
                "fn": "processData",
                "implHandler": [
                    "var ret = [],\r",
                    "    d, today = Ext.Date.clearTime(new Date()),\r",
                    "    startDate, name,\r",
                    "    makeDate = function(date, d, h, m) {\r",
                    "        h = (h || 0) * 60;\r",
                    "        m = (m || 0);\r",
                    "        date = Ext.Date.add(date, Ext.Date.DAY, d);\r",
                    "        return Ext.Date.add(date, Ext.Date.MINUTE, h + m);\r",
                    "    };\r",
                    "//debugger;\r",
                    "for (d = 0; d < records.length; d++) {\r",
                    "\r",
                    "    item = records[d];\r",
                    "    name = item.get('name');\r",
                    "    name = name.length > 30 ? name.substring(0,30) + ' ...' : name;\r",
                    "    //debugger;\r",
                    "    startDate = Ext.Date.clearTime(new Date(item.get('startdate')));\r",
                    "    ret.push(\r",
                    "    {\r",
                    "        \"eventID\": d,\r",
                    "        'event': item.get('raceid') ? 'Race' : 'Event' ,\r",
                    "        \"title\": name,\r",
                    "        'fulltitle': item.get('name'),\r",
                    "        \"start\": makeDate(startDate, 0, 1, 0),//Ext.Date.add(startDate, Ext.Date.SECOND, 1000),\r",
                    "        \"end\":  makeDate(startDate, 1, 0 , -1),//Ext.Date.add(startDate, Ext.Date.SECOND, 2000),\r",
                    "        recordRaw: item.raw,\r",
                    "        color: item.raw.color,\r",
                    "        css: 'red'\r",
                    "    });\r",
                    "\r",
                    "\r",
                    "}\r",
                    "return ret;"
                ]
            },
            "name": "processData",
            "designerId": "bde53f89-18b6-4793-a684-91c09ba7a5b3"
        }
    ]
}