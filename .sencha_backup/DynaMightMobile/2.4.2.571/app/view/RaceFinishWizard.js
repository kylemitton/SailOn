/*
 * File: app/view/RaceFinishWizard.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('DynaMightMobile.view.RaceFinishWizard', {
    extend: 'Ext.form.Panel',

    requires: [
        'Ext.form.FieldSet',
        'Ext.dataview.List',
        'Ext.XTemplate',
        'Ext.Button',
        'Ext.Label'
    ],

    config: {
        height: '100%',
        itemId: 'rfRacesFrm',
        layout: 'vbox',
        scrollable: false,
        items: [
            {
                xtype: 'container',
                flex: 1,
                itemId: 'racesCt',
                layout: 'hbox',
                items: [
                    {
                        xtype: 'fieldset',
                        flex: 1,
                        margin: 5,
                        layout: 'fit',
                        title: 'Today\'s Races',
                        items: [
                            {
                                xtype: 'list',
                                itemId: 'todayFinishRacesList',
                                itemTpl: Ext.create('Ext.XTemplate', 
                                    '',
                                    '<div class="item">',
                                    '    <div class="name">{name}',
                                    '    </div>',
                                    '    <div class="vicinity">Start time: {[this.DateFormat(values.starttime)]}',
                                    '    </div>',
                                    '    ',
                                    '</div>',
                                    {
                                        DateFormat: function(date) {
                                            //debugger;
                                            return date ? Ext.Date.format(new Date(date), 'Y-m-d H:i') : '';
                                        }
                                    }
                                )
                            }
                        ]
                    },
                    {
                        xtype: 'container',
                        itemId: 'buttonsCt',
                        layout: {
                            type: 'vbox',
                            align: 'center',
                            pack: 'center'
                        },
                        items: [
                            {
                                xtype: 'button',
                                itemId: 'finishAddBtn',
                                margin: 10,
                                ui: 'action-round',
                                text: '>>'
                            },
                            {
                                xtype: 'button',
                                itemId: 'finishDelBtn',
                                margin: 10,
                                ui: 'action-round',
                                text: '<<'
                            }
                        ]
                    },
                    {
                        xtype: 'fieldset',
                        flex: 1,
                        margin: 5,
                        layout: 'fit',
                        title: 'Races to Finish',
                        items: [
                            {
                                xtype: 'list',
                                itemId: 'finishRacesList',
                                itemTpl: Ext.create('Ext.XTemplate', 
                                    '',
                                    '<div class="item">',
                                    '    <div class="name">{name}',
                                    '    </div>',
                                    '    <div class="vicinity">Start time: {[this.DateFormat(values.starttime)]}',
                                    '    </div>',
                                    '    ',
                                    '</div>',
                                    {
                                        DateFormat: function(date) {
                                            return date ? Ext.Date.format(new Date(date), 'Y-m-d H:i') : '';
                                        }
                                    }
                                )
                            }
                        ]
                    }
                ]
            },
            {
                xtype: 'fieldset',
                margin: 5,
                title: 'Race Entrants',
                items: [
                    {
                        xtype: 'dataview',
                        height: 150,
                        itemId: 'entrantsFinishList',
                        inline: true,
                        itemTpl: [
                            '{[GetTemplate(\'boat\', values)]}'
                        ]
                    }
                ]
            },
            {
                xtype: 'container',
                docked: 'bottom',
                height: 40,
                itemId: 'bottomCt',
                margin: 10,
                items: [
                    {
                        xtype: 'button',
                        xurl: 'RFBoats',
                        disabled: true,
                        docked: 'right',
                        itemId: 'genericNextBtn',
                        ui: 'decline-round',
                        text: 'Next >>'
                    },
                    {
                        xtype: 'label',
                        docked: 'right',
                        html: 'Select Race(s) to Finish',
                        itemId: 'selectracesToFinishLbl',
                        margin: 10,
                        style: 'color:darkblue'
                    }
                ]
            }
        ]
    },

    initialize: function() {
        this.callParent();

        var me = this,
            boatStore = CreateStore("raceboat"),
            raceEntity = GetEntityByName("race"),
            raceStore = CreateStore("race"),
            rStore = CreateStore("race"),
            rsStore = CreateStore("boatstatus"),
            ctrl = DynaMightMobile.app.getController('RaceFinishWizard');

        APP.WarningUnsavedData = false;

        boatStore.execConfig({
            params: {
                entityViewID: GetEntityViewByName('BR').entityviewid ,
                filters: 'WHERE cast(startdate as date) = curdate()'
            }
        });

        //debugger;

        boatStore.sort('xindex', 'ASC');

        raceStore.execConfig({
            params: {
                entityViewID: GetEntityView(raceEntity.entityid).entityviewid ,
                filters: 'WHERE cast(startdate as date) = curdate()'
            },
            callback: function(s){
                if(s.length){

                    this.down('#todayFinishRacesList').select(s[0]);
                }
            },
            scope: me
        });

        //return;
        ctrl.rStore = rStore;
        ctrl.raceStore = raceStore;
        ctrl.boatStore = boatStore;


        //boatStore.filter('divisionid', '{6D98657E-5E29-810B-3D5E-D4C668C6FF2A}');

        me.down('#todayFinishRacesList').setStore(raceStore);
        me.down('#finishRacesList').setStore(rStore);
        me.down('#entrantsFinishList').setStore(boatStore);

        ctrl.races = me.down('#finishRacesList').getStore();

        Ext.Viewport.setMasked(false);
    }

});